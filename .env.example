# =============================================================================
# Backblaze Backend - Environment Variables Configuration
# =============================================================================
# Copy this file to .env and fill in your actual values
# DO NOT commit .env to version control - it contains sensitive credentials
# =============================================================================

# =============================================================================
# SERVER CONFIGURATION
# =============================================================================
# Port the server will listen on
PORT=3000

# Node environment (development, production, test)
NODE_ENV=development

# Trust proxy (set to 'true' if behind a load balancer/reverse proxy)
TRUST_PROXY=false

# =============================================================================
# BACKBLAZE B2 STORAGE - REQUIRED
# =============================================================================
# Get these from your Backblaze B2 account dashboard
# Account ID: 12-character hexadecimal string
B2_ACCOUNT_ID=your_12_char_account_id_here

# Application Key: Generated in B2 dashboard (Master Application Key or Application Key)
B2_APPLICATION_KEY=your_application_key_here

# Video Bucket Configuration
# Bucket ID: 24-character hexadecimal string (found in B2 bucket settings)
B2_VIDEO_BUCKET_ID=your_24_char_video_bucket_id_here
# Bucket Name: Optional - defaults to 'rushes-videos' if not set
B2_VIDEO_BUCKET_NAME=rushes-videos

# Thumbnail Bucket Configuration
B2_THUMBNAIL_BUCKET_ID=your_24_char_thumbnail_bucket_id_here
# Optional - defaults to 'rushes-thumbnails' if not set
B2_THUMBNAIL_BUCKET_NAME=rushes-thumbnails

# Profile Pictures Bucket Configuration
B2_PROFILE_BUCKET_ID=your_24_char_profile_bucket_id_here
# Optional - defaults to 'rushes-profile-pics' if not set
B2_PROFILE_BUCKET_NAME=rushes-profile-pics

# =============================================================================
# SUPABASE DATABASE - OPTIONAL
# =============================================================================
# Supabase project URL (found in Supabase project settings)
SUPABASE_URL=https://your-project-id.supabase.co

# Supabase service role key (found in Supabase project settings > API)
# WARNING: This key has admin privileges - keep it secure!
SUPABASE_SERVICE_ROLE_KEY=your_service_role_key_here

# =============================================================================
# CORS CONFIGURATION
# =============================================================================
# Comma-separated list of allowed origins for CORS
# Example: https://www.yourdomain.com,https://yourdomain.com,http://localhost:3000
ALLOWED_ORIGINS=https://www.rvshes.com,https://rvshes.com,http://localhost:3000,http://localhost:5173

# Enable strict CORS mode (only allow origins in ALLOWED_ORIGINS)
# Set to 'true' for production
CORS_STRICT_MODE=false

# =============================================================================
# UPLOAD CONFIGURATION
# =============================================================================
# Maximum file size in bytes (default: 100GB = 107374182400)
# Example: 100GB = 107374182400, 10GB = 10737418240
MAX_FILE_SIZE=107374182400

# Chunk size for uploads in bytes (default: 25MB = 26214400)
# Recommended: 25MB for optimal performance
CHUNK_SIZE=26214400

# Maximum concurrent chunks being processed (default: 1)
# Increase carefully - higher values use more memory
MAX_CONCURRENT_CHUNKS=1

# Upload timeout in milliseconds (default: 600000 = 10 minutes)
# Maximum allowed: 1800000 (30 minutes)
UPLOAD_TIMEOUT_MS=600000

# Number of retry attempts for failed uploads (default: 3, max: 5)
RETRY_ATTEMPTS=3

# Upload status retention time in milliseconds (default: 30 minutes)
UPLOAD_STATUS_RETENTION=1800000

# Upload cleanup interval in milliseconds (default: 10 minutes)
UPLOAD_CLEANUP_INTERVAL=600000

# =============================================================================
# FFMPEG CONFIGURATION
# =============================================================================
# Path to FFmpeg binary (default: 'ffmpeg' - assumes it's in PATH)
# On some systems: /usr/bin/ffmpeg or /usr/local/bin/ffmpeg
FFMPEG_BIN_PATH=ffmpeg

# FFmpeg operation timeout in milliseconds (default: 300000 = 5 minutes)
# Maximum allowed: 600000 (10 minutes)
FFMPEG_TIMEOUT=300000

# Maximum concurrent FFmpeg jobs (default: 2)
# Higher values may cause memory issues
MAX_FFMPEG_JOBS=2

# Temporary directory for FFmpeg operations
FFMPEG_TEMP_DIR=./uploads/temp

# =============================================================================
# RATE LIMITING CONFIGURATION
# =============================================================================
# Global rate limit - requests per IP per 15 minutes (default: 1000)
GLOBAL_RATE_LIMIT=1000

# Upload endpoint rate limit - requests per IP per 15 minutes (default: 20)
UPLOAD_RATE_LIMIT=20

# Multipart upload rate limit - requests per IP per 15 minutes (default: 5)
MULTIPART_RATE_LIMIT=5

# Disable rate limiting entirely (NOT RECOMMENDED for production)
# Set to 'true' to disable (default: false)
DISABLE_RATE_LIMITING=false

# =============================================================================
# FEATURE FLAGS
# =============================================================================
# Enable/disable specific upload methods
# Set to 'false' to disable a feature

# FormData uploads (traditional multipart/form-data)
ENABLE_FORMDATA_UPLOADS=true

# Legacy chunked uploads
ENABLE_LEGACY_CHUNKED=true

# Streaming proxy multipart uploads (recommended for large files)
ENABLE_MULTIPART_UPLOADS=true

# Background processing for thumbnails and metadata
ENABLE_BACKGROUND_PROCESSING=true

# Custom thumbnail uploads
ENABLE_CUSTOM_THUMBNAILS=true

# =============================================================================
# BACKGROUND PROCESSING CONFIGURATION
# =============================================================================
# Maximum concurrent background jobs (default: 2, max: 5)
MAX_BACKGROUND_JOBS=2

# Job retention time in milliseconds (default: 30 minutes)
JOB_RETENTION_TIME=1800000

# Background job processing interval in milliseconds (default: 2000 = 2 seconds)
# Minimum: 1000 (1 second)
BACKGROUND_JOB_INTERVAL=2000

# Maximum retry attempts for failed background jobs (default: 3, max: 5)
MAX_JOB_RETRY_ATTEMPTS=3

# Delay between retry attempts in milliseconds (default: 5000 = 5 seconds)
# Minimum: 1000 (1 second)
JOB_RETRY_DELAY=5000

# =============================================================================
# MULTIPART UPLOAD CONFIGURATION
# =============================================================================
# Default number of part URLs to pre-generate (default: 5, max: 20)
DEFAULT_PART_URL_COUNT=5

# Maximum parts per multipart upload (default: 10000, B2 limit)
MAX_MULTIPART_PARTS=10000

# Part URL expiration buffer in hours (default: 23 hours)
PART_URL_EXPIRATION_BUFFER=23

# Auto-cleanup incomplete multipart uploads (default: true)
AUTO_CLEANUP_INCOMPLETE_UPLOADS=true

# Incomplete upload cleanup time in hours (default: 24, max: 168 = 1 week)
INCOMPLETE_UPLOAD_CLEANUP_HOURS=24

# =============================================================================
# MEMORY MANAGEMENT
# =============================================================================
# Force garbage collection after each upload (default: true)
FORCE_GC_AFTER_UPLOAD=true

# Memory warning threshold percentage (default: 80, max: 95)
MEMORY_WARNING_THRESHOLD=80

# Memory critical threshold percentage (default: 90, max: 98)
MEMORY_CRITICAL_THRESHOLD=90

# Enable GC monitoring (default: true)
ENABLE_GC_MONITORING=true

# =============================================================================
# SERVER CONFIGURATION
# =============================================================================
# Server timeout in milliseconds (default: 1800000 = 30 minutes, max: 3600000 = 1 hour)
SERVER_TIMEOUT_MS=1800000

# Maximum concurrent connections (default: 1000)
MAX_CONNECTIONS=1000

# =============================================================================
# LOGGING CONFIGURATION
# =============================================================================
# Log level (debug, info, warn, error)
# Default: info (if not set)
LOG_LEVEL=info

# Enable enhanced logging (default: true)
ENABLE_ENHANCED_LOGGING=true

# =============================================================================
# NOTES
# =============================================================================
# 1. Required variables (server will fail to start without these):
#    - B2_ACCOUNT_ID
#    - B2_APPLICATION_KEY
#    - B2_VIDEO_BUCKET_ID
#    - B2_THUMBNAIL_BUCKET_ID
#    - B2_PROFILE_BUCKET_ID
#
# 2. Optional but recommended:
#    - SUPABASE_URL and SUPABASE_SERVICE_ROLE_KEY (for database features)
#    - ALLOWED_ORIGINS (for CORS security)
#
# 3. Bucket names are optional - defaults will be used if not set
#
# 4. For production:
#    - Set NODE_ENV=production
#    - Set CORS_STRICT_MODE=true
#    - Set DISABLE_RATE_LIMITING=false
#    - Review all security settings
#
# 5. Memory considerations:
#    - Thumbnail generation can use 2-3GB RAM for large videos
#    - Recommended: 2GB+ RAM for production
#    - Consider disabling thumbnail generation if memory is limited
#
# =============================================================================
